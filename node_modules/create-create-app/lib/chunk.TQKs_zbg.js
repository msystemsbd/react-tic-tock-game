"use strict";Object.defineProperty(exports, "__esModule", {value: true}); function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }var m=Object.assign,k=(a,b,c)=>new Promise((e,f)=>{var d=l=>{try{n(c.next(l))}catch(i){f(i)}},h=l=>{try{n(c.throw(l))}catch(i){f(i)}},n=l=>l.done?e(l.value):Promise.resolve(l.value).then(d,h);n((c=c.apply(a,b)).next())});var _fs = require('fs'); var _fs2 = _interopRequireDefault(_fs);var _globby = require('globby'); var _globby2 = _interopRequireDefault(_globby);var _handlebars = require('handlebars'); var _handlebars2 = _interopRequireDefault(_handlebars);var _isutf8 = require('is-utf8'); var _isutf82 = _interopRequireDefault(_isutf8);var _path = require('path'); var _path2 = _interopRequireDefault(_path);var _slash = require('slash'); var _slash2 = _interopRequireDefault(_slash);var _uuid = require('uuid');function J(a){return a.split(/[-_\s]+/)}function ha(a){return J(q(a)).join(" ")}_handlebars2.default.registerHelper("space",ha);function q(a){return a.replace(/[\r\n]/g,"")}_handlebars2.default.registerHelper("trim",q);function ia(a){return q(a).toUpperCase()}_handlebars2.default.registerHelper("upper",ia);function ja(a,b){const c=b&&b.hash&&b.hash.space;return q(a).toLowerCase()}_handlebars2.default.registerHelper("lower",ja);function A(a,b){const c=b&&b.hash&&b.hash.space;return J(q(a)).map(e=>e.charAt(0).toUpperCase()+e.slice(1).toLowerCase()).join(c?" ":"")}_handlebars2.default.registerHelper("capital",A);function ka(a){return A(a).replace(/^./,b=>b.toLowerCase())}_handlebars2.default.registerHelper("camel",ka);function K(a){return A(a).replace(/(?<=([a-z](?=[A-Z])|[A-Za-z](?=[0-9])))(?=[A-Z0-9])/g,"_").toLowerCase()}_handlebars2.default.registerHelper("snake",K);function la(a){return K(a).replace(/_/g,"-")}_handlebars2.default.registerHelper("kebab",la);function ma(){return _uuid.v4.call(void 0, )}_handlebars2.default.registerHelper("uuid",ma);function L(a,b){const c=_handlebars2.default.compile(a.toString(),{noEscape:!0});return c(b)}function na(a){try{const b=_path2.default.dirname(a);_fs2.default.mkdirSync(b,{recursive:!0})}catch(b){}}function H(a){return _fs2.default.readdirSync(a).filter(b=>!b.startsWith("."))}function G(a){return k(this,[],function*(){const b=yield _globby2.default.call(void 0, _slash2.default.call(void 0, a.templateDir),{dot:!0});for(const c of b){const e=_path2.default.relative(a.templateDir,c),f=L(_path2.default.resolve(a.packageDir,e),a.view);na(f);let d=_fs2.default.readFileSync(c),h=d;_isutf82.default.call(void 0, d)&&(h=Buffer.from(L(d,a.view))),_fs2.default.writeFileSync(f,h,"utf-8")}})}var _chalk = require('chalk'); var _chalk2 = _interopRequireDefault(_chalk);var _crossspawn = require('cross-spawn');var _epicfail = require('epicfail'); var _epicfail2 = _interopRequireDefault(_epicfail);var _execa = require('execa'); var _execa2 = _interopRequireDefault(_execa);var _gitconfig = require('gitconfig'); var _gitconfig2 = _interopRequireDefault(_gitconfig);var _licensejs = require('license.js');var _yargsinteractive = require('yargs-interactive'); var _yargsinteractive2 = _interopRequireDefault(_yargsinteractive);class r extends Error{constructor(a){super(a);this.name="CLIError"}}function X(){return k(this,[],function*(){try{const a=yield _gitconfig2.default.get({location:"global"});return a.user}catch(a){return{}}})}function Y(a,b=[],c={}){return new Promise((e,f)=>{const d=_crossspawn.spawn.call(void 0, a,b,m({stdio:"inherit"},c));d.on("close",h=>{if(h!==0)return f(h);e(h)})})}function Z(a,b){return k(this,[],function*(){let c,e;b?(c="yarnpkg",e=["install","--cwd",a]):(c="npm",e=["install"],process.chdir(a));try{yield Y(c,e,{stdio:"inherit"})}catch(f){throw new r(`installDeps failed: ${f}`)}})}function _(){return k(this,[],function*(){try{return yield _execa2.default.call(void 0, "yarnpkg",["--version"]),!0}catch(a){return!1}})}function $(a,b){return _fs2.default.existsSync(_path2.default.resolve(b,a))}function aa(a){return k(this,[],function*(){yield _execa2.default.call(void 0, "git init",{shell:!0,cwd:a})})}function I(a,b){return`${a}${b?` <${b}>`:""}`}function ba(a){try{return _fs2.default.readdirSync(a).filter(b=>!b.startsWith(".")).length!==0}catch(b){if(b.code==="ENOENT")return!1;throw b}}function ca(a,b,c={}){return k(this,[],function*(){const e=yield X(),f=H(a),d=f.length>1,h=d&&b,n=m({interactive:{default:!0},description:{type:"input",describe:"description",default:"description",prompt:"if-no-arg"},author:{type:"input",describe:"author name",default:e.name,prompt:"if-no-arg"},email:{type:"input",describe:"author email",default:e.email,prompt:"if-no-arg"},template:{type:"list",describe:"template",default:"default",prompt:h?"if-no-arg":"never",choices:f},license:{type:"list",describe:"license",choices:_licensejs.availableLicenses.call(void 0, ),prompt:"if-no-arg"}},c);return n})}function R(a,b){return k(this,[],function*(){_epicfail2.default.call(void 0, {assertExpected:g=>g.name==="CLIError"});const c=process.argv[2];if(c===void 0)throw new r(`${a} <name>`);const e=c===".",f=e?_path2.default.basename(process.cwd()):b.modifyName?yield Promise.resolve(b.modifyName(c)):c,d=e?process.cwd():_path2.default.resolve(f),{templateRoot:h,promptForTemplate:n=!1}=b;if(ba(d))throw new r(`${d} is not empty directory.`);const l=yield ca(h,n,b.extra),i=yield _yargsinteractive2.default.call(void 0, ).usage("$0 <name> [args]").interactive(l),M=i.template,B=_path2.default.resolve(h,M),C=new Date().getFullYear(),N=I(i.author,i.email);if(!_fs2.default.existsSync(B))throw new r("No template found");const O=Object.entries(i).filter(g=>g[0].match(/^[^$_]/)&&!["interactive","template"].includes(g[0])).reduce((g,o)=>(g[o[0]]=o[1],g),{}),oa=m(m({},O),{name:f,year:C,contact:N});console.log(`
Creating a new package in ${_chalk2.default.green(d)}.
`),yield G({packageDir:d,templateDir:B,view:oa});const D=_licensejs.makeLicenseSync.call(void 0, i.license,{year:C,project:f,description:i.description,organization:I(i.author,i.email)}),pa=D.header+D.text+D.warranty;_fs2.default.writeFileSync(_path2.default.resolve(d,"LICENSE"),pa);const P=yield _();$("package.json",d)&&(console.log("Installing dependencies."),yield Z(d,P));try{yield aa(d),console.log(`
Initialized a git repository`)}catch(g){if(g.exitCode==127)return;throw g}const qa=(g,o={})=>{const u=g.split(" ");return _execa2.default.call(void 0, u[0],u.slice(1),m({stdio:"inherit",cwd:d},o))},ra=g=>new Promise((o,u)=>{let v,w;P?(v="yarnpkg",w=["--cwd",d,"add",g]):(v="npm",w=["install","-D",g],process.chdir(d));const sa=_crossspawn.spawn.call(void 0, v,w,{stdio:"inherit"});sa.on("close",ta=>{if(ta!==0)return u(`installDeps failed: ${v} ${w.join(" ")}`);o()})}),Q={name:f,packageDir:d,template:M,templateDir:B,year:C,run:qa,installNpmPackage:ra,answers:m(m({},O),{contact:N})};b.after&&(yield Promise.resolve(b.after(Q))),console.log(`
Success! Created ${_chalk2.default.bold.cyan(f)}.`);if(b.caveat)switch(typeof b.caveat){case"string":console.log(b.caveat);break;case"function":const g=yield Promise.resolve(b.caveat(Q));g&&console.log(g);break;default:}})}exports.a = r; exports.b = R;
